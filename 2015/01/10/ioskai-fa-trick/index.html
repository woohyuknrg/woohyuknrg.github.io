
 <!DOCTYPE HTML>
<html >
<head>
  <meta charset="UTF-8">
  
    <title>ios开发trick | Ray&#39;s blog</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=3, minimum-scale=1">
    
    <meta name="author" content="Ray">
    
    <meta name="description" content="译自：http://nshipster.com/new-years-2015/
##成员函数的秘密swift类和结构体的成员函数总是有以下2种等价调用形式：
[1, 2, 3, 4].reverse()
Array.reverse([1, 2, 3, 4])()
##@()封装C字符串除了封装数字和用在集合上，还可用于char *
NSString *propertyAttributesString =
@(property_getAttributes(class_getProperty([NSObject class], &quot;description&quot;)));
//输出：T@&quot;NSString&quot;,R,C
##AmIBeingDebugged判断app是否在调试器下运行的函数
#include &amp;lt;assert.h&amp;gt;
#include &amp;lt;stdbool.h&amp;gt;
#include &amp;lt;sys/types.h&amp;gt;
#include &amp;lt;unistd.h&amp;gt;
#include &amp;lt;sys/sysctl.h&amp;gt;

static bool AmIBeingDebugged(void) {
    int mib[4];
    struct kinfo_proc info;
    size_t size = sizeof(info);

    info.kp_proc.p_flag = 0;

    mib[0] = CTL_KERN;
    mib[1] = KERN_PROC;
    mib[2] = KERN_PROC_PID;
    mib[3] = getpid();

    sysctl(mib, sizeof(mib) / sizeof(*mib), &amp;amp;info, &amp;amp;size, NULL, 0);

    return (info.kp_proc.p_flag &amp;amp; P_TRACED) != 0;
}">
    
    
    
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/pacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/pacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css" type="text/css">
</head>

  <body>
    <header>
      <div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.svg" alt="Ray&#39;s blog" title="Ray&#39;s blog"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="Ray&#39;s blog">Ray&#39;s blog</a></h1>
				<h2 class="blog-motto">iOSer</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜單">
			</a></div>
			<nav class="animated">
				<ul>
					
						<li><a href="/">Home</a></li>
					
						<li><a href="/archives">Archives</a></li>
					
					<li>
					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="text" id="search" name="q" autocomplete="off" maxlength="20" placeholder="搜索" />
						<input type="hidden" name="q" value="site:woohyuknrg.github.io">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>

    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/01/10/ioskai-fa-trick/" title="ios开发trick" itemprop="url">ios开发trick</a>
  </h1>
  <p class="article-author">By
    
      <a href="http://woohyuknrg.github.io" title="Ray">Ray</a>
    </p>
  <p class="article-time">
    <time datetime="2015-01-10T02:30:17.000Z" itemprop="datePublished">2015-01-10</time>
    更新日期:<time datetime="2015-01-10T04:19:13.000Z" itemprop="dateModified">2015-01-10</time>
    
  </p>
</header>
	<div class="article-content">
		
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">文章目錄</strong>
		
		</div>
		
		<p>译自：<a href="http://nshipster.com/new-years-2015/" target="_blank" rel="external">http://nshipster.com/new-years-2015/</a></p>
<p>##成员函数的秘密<br>swift类和结构体的成员函数总是有以下2种等价调用形式：</p>
<pre><code>[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>].reverse()
Array.reverse([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>])()
</code></pre><p>##@()封装C字符串<br>除了封装数字和用在集合上，还可用于char *</p>
<pre><code>NSString *propertyAttributesString =
@(property<span class="number">_</span>getAttributes(<span class="keyword">class</span><span class="number">_</span>getProperty([NSObject <span class="keyword">class</span>], <span class="string">"description"</span>)));
<span class="comment">//输出：T@"NSString",R,C</span>
</code></pre><p>##AmIBeingDebugged<br>判断app是否在调试器下运行的函数</p>
<pre><code><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;assert.h&gt;</span></span>
<span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;stdbool.h&gt;</span></span>
<span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;sys/types.h&gt;</span></span>
<span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span>
<span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;sys/sysctl.h&gt;</span></span>

<span class="function"><span class="keyword">static</span> <span class="keyword">bool</span> <span class="title">AmIBeingDebugged</span><span class="params">(<span class="keyword">void</span>)</span> </span>{
    <span class="keyword">int</span> mib[<span class="number">4</span>];
    <span class="keyword">struct</span> kinfo_proc info;
    <span class="keyword">size_t</span> size = <span class="keyword">sizeof</span>(info);

    info.kp_proc.p_flag = <span class="number">0</span>;

    mib[<span class="number">0</span>] = CTL_KERN;
    mib[<span class="number">1</span>] = KERN_PROC;
    mib[<span class="number">2</span>] = KERN_PROC_PID;
    mib[<span class="number">3</span>] = getpid();

    sysctl(mib, <span class="keyword">sizeof</span>(mib) / <span class="keyword">sizeof</span>(*mib), &amp;info, &amp;size, <span class="literal">NULL</span>, <span class="number">0</span>);

    <span class="keyword">return</span> (info.kp_proc.p_flag &amp; P_TRACED) != <span class="number">0</span>;
}
</code></pre><a id="more"></a>
<p>##使用延迟变量<br>尽量避免声明optional变量，但没有初始值怎么办，使用<strong>lazy</strong>关键字，谨记在有实际值前不要调用getter，例如：</p>
<pre><code>lazy <span class="tag">var</span> someModelStructure = <span class="function"><span class="title">ExpensiveClass</span><span class="params">()</span></span>
</code></pre><p>如果在调用getter前调用了setter，则<code>ExpensiveClass()</code>永远不会执行。适用于<code>viewDidLoad</code>里才初始化的IBOutlet视图</p>
<p>##获取插入到storyboard的容器视图的子控制器</p>
<pre><code><span class="comment">// 1. A property has the same name as a segue identifier in XIB</span>
<span class="keyword">@property</span> (<span class="keyword">nonatomic</span>) ChildViewController1 *childController1;
<span class="keyword">@property</span> (<span class="keyword">nonatomic</span>) ChildViewController2 *childController2;

<span class="comment">// #pragma mark - UIViewController</span>

- (<span class="keyword">void</span>)prepareForSegue:(<span class="built_in">UIStoryboardSegue</span> *)segue
                 sender:(<span class="keyword">id</span>)sender
{
    [<span class="keyword">super</span> prepareForSegue:segue sender:sender];

    <span class="comment">// 2. All known destination controllers assigned to properties</span>
    <span class="keyword">if</span> ([<span class="keyword">self</span> respondsToSelector:<span class="built_in">NSSelectorFromString</span>(segue<span class="variable">.identifier</span>)]    ) {
        [<span class="keyword">self</span> setValue:segue<span class="variable">.destinationViewController</span> forKey:segue<span class="variable">.identifier</span>];
    }
}

- (<span class="keyword">void</span>)viewDidLoad 
{
    [<span class="keyword">super</span> viewDidLoad];

    <span class="comment">// 3. Controllers already available bc viewDidLoad is called after prepareForSegue</span>
    <span class="keyword">self</span><span class="variable">.childController1</span><span class="variable">.view</span><span class="variable">.backgroundColor</span> = [<span class="built_in">UIColor</span> redColor];
    <span class="keyword">self</span><span class="variable">.childController2</span><span class="variable">.view</span><span class="variable">.backgroundColor</span> = [<span class="built_in">UIColor</span> blueColor];
}
</code></pre><p>##不编译重运行<br>Product &gt; Perform Action &gt; Run without Building </p>
<p>快捷键：⌘⌃R</p>
<p>##快速获取Playground资源文件<br>Playground共享同一数据文件夹：<strong>/HOME/Documents/Shared Playground Data</strong>，以下为获取资源文件路径的方法：</p>
<pre><code><span class="keyword">import</span> XCPlayground
<span class="func"><span class="keyword">func</span> <span class="title">pathToFileInSharedSubfolder</span><span class="params">(file: String)</span></span> -&gt; <span class="type">String</span> {
    <span class="keyword">return</span> <span class="type">XCPSharedDataDirectoryPath</span> + <span class="string">"/"</span> + <span class="type">NSProcessInfo</span>.processInfo().processName + <span class="string">"/"</span> + file
}
</code></pre><p>processName即为Playground文件名，例如要获取本地json数据：</p>
<pre><code><span class="tag">var</span> <span class="rule"><span class="attribute">jsonReadError</span>:<span class="value">NSError?
let jsonData = NSFileManager.<span class="function">defaultManager</span>().<span class="function">contentsAtPath</span>(<span class="function">pathToFileInSharedSubfolder</span>(<span class="string">"data.json"</span>))!
let jsonArray = NSJSONSerialization.<span class="function">JSONObjectWithData</span>(jsonData, options: nil, error: &amp;jsonReadError) as [AnyObject]</span></span>
</code></pre><p>##CocoaPods<br>查看app所使用的所有pods：</p>
<p><code>class-dump -C Pods_ /Applications/Squire.app | grep -o &quot;Pods_\w+&quot;</code></p>
<p>##阻止dylib Hooking<br>在项目设置<strong>Other Linker Flags</strong>里添加：</p>
<p><code>-Wl,-sectcreate,__RESTRICT,__restrict,/dev/null</code></p>
<p>##获取app运行使用的语言<br><code>[[NSBundle mainBundle] preferredLocalizations]</code></p>
<p>##NSDateFormatter +dateFormatFromTemplate:options:locale:<br>日期格式化模板例子：</p>
<pre><code>NSLocale *usLocale = [[NSLocale alloc] <span class="string">initWithLocaleIdentifier:</span>@<span class="string">"en_US"</span>];
NSLocale *gbLocale = [[NSLocale alloc] <span class="string">initWithLocaleIdentifier:</span>@<span class="string">"en_GB"</span>];

NSString *dateFormat;
NSString *dateComponents = @<span class="string">"yMMMMd"</span>;

dateFormat = [NSDateFormatter <span class="string">dateFormatFromTemplate:</span>dateComponents <span class="string">options:</span><span class="number">0</span> <span class="string">locale:</span>usLocale];
NSLog(@<span class="string">"Date format for %@: %@"</span>,
    [usLocale <span class="string">displayNameForKey:</span>NSLocaleIdentifier <span class="string">value:</span>[usLocale localeIdentifier]], dateFormat);

dateFormat = [NSDateFormatter <span class="string">dateFormatFromTemplate:</span>dateComponents <span class="string">options:</span><span class="number">0</span> <span class="string">locale:</span>gbLocale];
NSLog(@<span class="string">"Date format for %@: %@"</span>,
    [gbLocale <span class="string">displayNameForKey:</span>NSLocaleIdentifier <span class="string">value:</span>   [gbLocale localeIdentifier]], dateFormat);

<span class="comment">// Output:</span>
<span class="comment">// Date format for English (United States): MMMM d, y</span>
<span class="comment">// Date format for English (United Kingdom): d MMMM y</span>
</code></pre><p>##通过lldb获得内部常量<br>获得转场动画的持续时间：</p>
<ol>
<li>设置断点：<code>(lldb) br set -n &quot;+[UITransitionView defaultDurationForTransition:]&quot;</code></li>
<li>展示模态视图以触发断点，然后执行：<code>(lldb) finish</code></li>
<li>从<strong>xmm0</strong>寄存器读取结果：<code>(lldb) register read xmm0 --format float64</code>，输出<code>xmm0 = {0.4 0}</code>，0.4即为持续时间</li>
</ol>
<p>##自定义弱引用关联对象</p>
<pre><code><span class="class"><span class="keyword">@interface</span> <span class="title">WeakObjectContainter</span> : <span class="title">NSObject</span></span>
<span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">readonly</span>, <span class="keyword">weak</span>) <span class="keyword">id</span> object;
<span class="keyword">@end</span>

<span class="class"><span class="keyword">@implementation</span> <span class="title">WeakObjectContainter</span></span>

- (instancetype)initWithObject:(<span class="keyword">id</span>)object {
    <span class="keyword">self</span> = [<span class="keyword">super</span> init];
    <span class="keyword">if</span> (!<span class="keyword">self</span>) {
        <span class="keyword">return</span> <span class="literal">nil</span>;
    }

    <span class="keyword">self</span><span class="variable">.object</span> = object;

    <span class="keyword">return</span> <span class="keyword">self</span>;
}
<span class="keyword">@end</span>
</code></pre><p>使用：</p>
<pre><code>objc_setAssociatedObject<span class="list">(<span class="keyword">self</span>, <span class="keyword">&amp;MyKey</span>, [[WeakObjectContainter alloc] initWithObject<span class="keyword">:object</span>], OBJC_ASSOCIATION_RETAIN_NONATOMIC)</span>
</code></pre><p>获取弱引用对象：</p>
<pre><code>id <span class="class"><span class="keyword">object</span> =</span> [objc_getAssociatedObject(self, &amp;<span class="type">MyKey</span>) <span class="class"><span class="keyword">object</span>];</span>
</code></pre>  
	</div>
		<footer class="article-footer clearfix">


<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/ios/">ios</a>
</div>



<div class="article-share" id="share">

  <div data-url="http://woohyuknrg.github.io/2015/01/10/ioskai-fa-trick/" data-title="ios开发trick | Ray&#39;s blog" data-tsina="null" class="share clearfix">
  </div>

</div>
</footer>   	       
	</article>
	
<nav class="article-nav clearfix">
 

<div class="next">
<a href="/2014/11/08/ios-weekly-report-1/"  title="ios weekly report 1">
 <strong>NEXT:</strong><br/> 
 <span>ios weekly report 1
</span>
</a>
</div>

</nav>

	
</div>  
      <div class="openaside"><a class="navbutton" href="#" title="顯示側邊欄"></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">文章目錄</strong>
  
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隱藏側邊欄"></a></div>
<aside class="clearfix">

  
<div class="categorieslist">
	<p class="asidetitle">分類</p>
		<ul>
		
			<li><a href="/categories/ios/" title="ios">ios<sup>5</sup></a></li>
		
			<li><a href="/categories/other/" title="other">other<sup>1</sup></a></li>
		
		</ul>
</div>


  
<div class="tagslist">
	<p class="asidetitle">標簽</p>
		<ul class="clearfix">
		
			<li><a href="/tags/KIF/" title="KIF">KIF<sup>1</sup></a></li>
		
			<li><a href="/tags/Reveal/" title="Reveal">Reveal<sup>1</sup></a></li>
		
			<li><a href="/tags/c/" title="c++">c++<sup>1</sup></a></li>
		
			<li><a href="/tags/github/" title="github">github<sup>1</sup></a></li>
		
			<li><a href="/tags/ios/" title="ios">ios<sup>1</sup></a></li>
		
			<li><a href="/tags/mac/" title="mac">mac<sup>1</sup></a></li>
		
			<li><a href="/tags/octopress/" title="octopress">octopress<sup>1</sup></a></li>
		
			<li><a href="/tags/单元测试/" title="单元测试">单元测试<sup>1</sup></a></li>
		
		</ul>
</div>


  <div class="rsspart">
	<a href="null" target="_blank" title="rss">RSS 訂閱</a>
</div>

</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<div class="social-font clearfix">
		
		
		
		
		
	</div>
		<p class="copyright">Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/A-limon/pacman" target="_blank" title="Pacman">Pacman</a> © 2015 
		
		<a href="http://woohyuknrg.github.io" target="_blank" title="Ray">Ray</a>
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.1.0.min.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else
    {
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      h  = $('article h2')
      ah = $('article h2'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  if(ah.length==0){
    t.css('display','none');
  }else{
    c.click(function(){
      ta.css('display', 'block').addClass('fadeIn');
    });
    o.click(function(){
      ta.css('display', 'none');
    });
    $(window).scroll(function(){
      ta.css("top",Math.max(140,320-$(this).scrollTop()));
    });
  };
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina');
  var html = [
  '<a href="#" class="overlay" id="qrcode"></a>',
  '<div class="qrcode clearfix"><span>扫描二维码分享到微信朋友圈</span><a class="qrclose" href="#share"></a><strong>Loading...Please wait</strong><img id="qrcode-pic" data-src="http://s.jiathis.com/qrcode.php?url=' + encodedUrl + '"/></div>',
  '<a href="#textlogo" class="article-back-to-top" title="Top"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="QRcode"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="Weibo"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);
  $('.article-share-qrcode').click(function(){
    var imgSrc = $('#qrcode-pic').attr('data-src');
    $('#qrcode-pic').attr('src', imgSrc);
    $('#qrcode-pic').load(function(){
        $('.qrcode strong').text(' ');
    });
  });
});     
</script>






  </body>
</html>
